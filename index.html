<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Friend Leaderboard</title>
    <link href="style.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
</head>
<body>

<div class="app-container">
    
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="logo">
            <i class="fa-solid fa-chess-knight"></i>
            <span>ChessFriends</span>
        </div>
        
        <nav class="nav-menu">
            <button class="nav-btn active" data-tab="leaderboard">
                <i class="fa-solid fa-trophy"></i> Рейтинг
            </button>
            <button class="nav-btn" data-tab="games">
                <i class="fa-solid fa-chess-board"></i> Партии
            </button>
            <button class="nav-btn" data-tab="duels">
                <i class="fa-solid fa-table-cells"></i> Дуэли
            </button>
            <button class="nav-btn" data-tab="profile">
                <i class="fa-solid fa-user"></i> Профиль
            </button>
        </nav>


        <!-- Mini Profile -->
        <div class="mini-profile" id="sidebar-mini-profile">
            <div class="mini-profile-avatar">
                <i class="fa-solid fa-user-circle"></i>
            </div>
            <div class="mini-profile-info">
                <div class="mini-username" id="mini-username-display">Гость</div>
                <div class="mini-balance"><span id="mini-balance-display">0</span> </div>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        
        <!-- Tab: Leaderboard -->
        <section id="tab-leaderboard" class="tab-content active">

            <header class="content-header">
                <h1>Таблица лидеров</h1>
                <div class="header-actions">
                    <div class="last-update" id="last-update">Обновлено: никогда</div>
                    <button id="refresh-btn" class="icon-btn" title="Обновить"><i class="fa-solid fa-rotate-right"></i></button>
                </div>
            </header>

            <div class="rating-mode-switch">
                <label class="switch-label">
                    <input type="radio" name="rating-mode" value="lichess" checked>
                    <span>Lichess Rating</span>
                </label>
                <label class="switch-label">
                    <input type="radio" name="rating-mode" value="internal">
                    <span>Internal Rating</span>
                </label>
            </div>

            <div class="table-container scrollable-area">
                <table class="leaderboard-table">
                    <thead>
                        <tr id="table-head-row">
                            <!-- Headers generated by JS -->
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- Rows generated by JS -->
                    </tbody>
                </table>
                <div id="loading-spinner" class="spinner" style="display:none;"></div>
                
                <div class="leaderboard-footer-actions">
                    <button id="recalc-internal-btn" class="recalc-btn" style="display:none;">
                        <i class="fa-solid fa-calculator"></i> Пересчитать
                    </button>
                </div>
            </div>
        </section>

        <!-- Tab: Games -->
        <section id="tab-games" class="tab-content">
            <header class="content-header">
                <h1>История партий</h1>
                <div class="filter-controls">
                    <select id="games-filter-select">
                        <option value="all">Все партии</option>
                        <!-- Players populated by JS -->
                    </select>
                </div>
            </header>

            <div id="games-list" class="games-grid scrollable-area">
                <!-- Games populated by JS -->
            </div>
        </section>

        <!-- Tab: Duels -->
        <section id="tab-duels" class="tab-content">
            <header class="content-header">
                <h1>Матрица дуэлей</h1>
                <div class="header-actions">
                    <div class="last-update" id="duels-last-update">Обновлено: никогда</div>
                    <button id="duels-refresh-btn" class="icon-btn" title="Обновить"><i class="fa-solid fa-rotate-right"></i></button>
                </div>
            </header>

            <div class="duels-hint">
                Показывает W-L-D между зарегистрированными пользователями (учитываются только привязанные Lichess аккаунты).
            </div>

            <div class="duels-matrix-wrap scrollable-area" id="duels-matrix-wrap">
                <div class="spinner" id="duels-spinner" style="display:none;"></div>
                <table class="duels-matrix" id="duels-matrix"></table>
            </div>
        </section>

        <!-- Tab: Profile -->
        <section id="tab-profile" class="tab-content">
            <header class="content-header">
                <h1>Профиль игрока</h1>
                <select id="profile-select-user" class="profile-selector">
                    <!-- Options populated by JS -->
                </select>
            </header>

            <div style="padding: 0 20px 12px 20px;">
                <div style="background: var(--bg-panel); border: 1px solid var(--border-color); padding: 12px;">
                    <div style="font-weight: 600;">Привязка Lichess (опционально)</div>
                    <div id="lichess-link-status" style="margin-top: 4px; color: var(--text-muted); font-size: 12px;">Статус: —</div>
                    <div style="display:flex; gap:10px; margin-top:10px;">
                        <input type="password" id="lichess-token" placeholder="Lichess API Token" autocomplete="off" style="flex:1;">
                        <button id="link-lichess" class="login-confirm-btn" style="white-space:nowrap;">Привязать</button>
                    </div>
                    <div style="margin-top: 8px; color: var(--text-muted); font-size: 11px; line-height: 1.35;">
                        Токен нужен только для подтверждения владения аккаунтом. Если не хочешь — просто не привязывай.
                    </div>
                </div>
            </div>
            
            <div class="profile-layout scrollable-area">
                <div class="profile-card-large" id="profile-card-container">
                    <!-- Profile Content JS -->
                </div>
            </div>
        </section>

    </main>
    
    <!-- Chat Sidebar (Right) -->
    <aside class="chat-sidebar">
        <div class="chat-wrapper">
            <div class="chat-header">
                Чат
            </div>
            <div id="chat-window" class="chat-window">
                <!-- Messages -->
            </div>
            <div class="chat-controls">
                <input type="text" id="chat-input" placeholder="Сообщение...">
                <button id="chat-send-btn"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>
    </aside>

</div>

<!-- Login Modal -->
<div id="login-modal" class="modal-overlay active">
    <div class="modal-card">
        <h2>Вход</h2>
        <p>Зарегистрируйся или войди. Привязка Lichess — опционально и делается в профиле после входа.</p>

        <input type="text" id="auth-username" placeholder="Логин (3-24: A-Z, 0-9, _)" autocomplete="username">
        <input type="password" id="auth-password" placeholder="Пароль (минимум 8 символов)" autocomplete="current-password">

        <div style="display:flex; gap:10px; margin-top:10px;">
            <button id="auth-login" class="login-confirm-btn" style="flex:1;">Войти</button>
            <button id="auth-register" class="login-confirm-btn" style="flex:1; background:#40444b;">Регистрация</button>
        </div>

        <div id="auth-error" style="margin-top:10px; color:#e74c3c; font-size:12px; min-height:16px;"></div>
    </div>
</div>

<div id="equipment-modal" class="modal-overlay">
    <!-- Populated by JS -->
</div>

<script src="script.js"></script>
</body>
</html>
